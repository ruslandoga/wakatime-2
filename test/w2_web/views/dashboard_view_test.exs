defmodule W2Web.DashboardViewTest do
  use ExUnit.Case, async: true
  import W2Web.DashboardView

  test "prepare_chart_for_svg/3" do
    buckets = [
      [1_654_239_600, %{"fly-wg" => 413, "sentence-mining" => 368}],
      [1_654_243_200, %{"sentence-mining" => 225, "w2" => 1057}],
      [1_654_250_400, %{"w2" => 1471}],
      [1_654_254_000, %{"w2" => 1164}],
      [1_654_257_600, %{"w2" => 2529}],
      [1_654_261_200, %{"w2" => 2063}],
      [1_654_264_800, %{"w2" => 1281}],
      [1_654_268_400, %{"w2" => 597}],
      [1_654_272_000, %{"w2" => 3600}],
      [1_654_275_600, %{"w2" => 3164}],
      [1_654_279_200, %{"w2" => 310}],
      [1_654_326_000, %{"w2" => 2382}],
      [1_654_362_000, %{"learning" => 923, "ziglings" => 994}],
      [1_654_365_600, %{"ziglings" => 497}],
      [1_654_372_800, %{"ziglings" => 460}],
      [1_654_419_600, %{"ziglings" => 1183}],
      [1_654_423_200, %{"ziglings" => 1222}],
      [1_654_426_800, %{"ziglings" => 1512}],
      [1_654_430_400, %{"ziglings" => 2660}],
      [1_654_444_800, %{"ziglings" => 0}],
      [1_654_448_400, %{"ziglings" => 557}],
      [1_654_452_000, %{"ziglings" => 2291}],
      [1_654_462_800, %{"texture" => 6}],
      [1_654_516_800, %{"ziglings" => 758}],
      [
        1_654_520_400,
        %{"hello-world" => 188, "lasagna" => 298, "pacman-rules" => 113, "ziglings" => 740}
      ],
      [1_654_524_000, %{"ziglings" => 2004}],
      [1_654_527_600, %{"objdump2" => 1203, "ziglings" => 1327}],
      [1_654_531_200, %{"ziglearn" => 1574, "ziglings" => 1662}],
      [1_654_534_800, %{"ziglearn" => 453}],
      [1_654_538_400, %{"n" => 17}],
      [1_654_542_000, %{"n" => 1148}],
      [1_654_545_600, %{"n" => 0}],
      [1_654_603_200, %{"ziglearn" => 900}],
      [1_654_610_400, %{"ziglearn" => 2692}],
      [1_654_614_000, %{"ziglearn" => 2277}],
      [1_654_617_600, %{"ziglearn" => 2873}],
      [1_654_621_200, %{"ziglearn" => 1845}],
      [1_654_624_800, %{"w2" => 1469}],
      [1_654_628_400, %{"ziglearn" => 1950}],
      [1_654_682_400, %{"ziglearn" => 2421}],
      [1_654_686_000, %{"ziglearn" => 2058}],
      [1_654_689_600, %{"ziglearn" => 1627}],
      [1_654_693_200, %{"table-helper" => 30, "ziglearn" => 1356}],
      [1_654_696_800, %{"learnXinY" => 560, "ziglearn" => 1533}],
      [1_654_700_400, %{"learnXinY" => 2}],
      [1_654_704_000, %{"double" => 2399, "learnXinY" => 100}],
      [1_654_707_600, %{"double" => 2471}],
      [1_654_711_200, %{"double" => 2724}],
      [1_654_714_800, %{"double" => 1540, "w2" => 765}],
      [1_654_718_400, %{"double" => 461, "w2" => 224}],
      [1_654_747_200, %{"double" => 1531, "w2" => 336}],
      [1_654_750_800, %{"double" => 978, "e" => 1697, "w2" => 59}],
      [1_654_754_400, %{"double" => 0, "e" => 475, "w2" => 1021}],
      [1_654_758_000, %{"durations" => 284, "w2" => 1909}],
      [1_654_761_600, %{"durations" => 2922}],
      [1_654_765_200, %{"durations" => 2270}],
      [1_654_768_800, %{"durations" => 751}],
      [1_654_776_000, %{"durations" => 232}],
      [1_654_783_200, %{"w2" => 522}],
      [1_654_794_000, %{"durations" => 414}],
      [1_654_797_600, %{"durations" => 3600}],
      [1_654_801_200, %{"durations" => 3600}],
      [1_654_804_800, %{"durations" => 2261}],
      [1_654_833_600, %{"mkjson" => 254}]
    ]

    # colors: %{
    #   "double" => "bg-sky-600",
    #   "durations" => "bg-yellow-400",
    #   "e" => "bg-pink-500",
    #   "fly-wg" => "bg-cyan-500",
    #   "hello-world" => "bg-cyan-500",
    #   "lasagna" => "bg-neutral-400",
    #   "learnXinY" => "bg-amber-400",
    #   "learning" => "bg-blue-400",
    #   "mkjson" => "bg-amber-400",
    #   "n" => "bg-green-400",
    #   "objdump2" => "bg-green-400",
    #   "pacman-rules" => "bg-neutral-400",
    #   "sentence-mining" => "bg-amber-400",
    #   "table-helper" => "bg-green-400",
    #   "texture" => "bg-yellow-400",
    #   "w2" => "bg-red-400",
    #   "ziglearn" => "bg-blue-400",
    #   "ziglings" => "bg-pink-500"
    # },

    from = 1_654_236_614
    # to = 1_654_841_414
    interval = 3600

    assert prepare_chart_for_svg(from, interval, buckets) == [
             %{height: 368, project: "sentence-mining", x: 1, y: 2819},
             %{height: 413, project: "fly-wg", x: 1, y: 3187},
             %{height: 1057, project: "w2", x: 2, y: 2318},
             %{height: 225, project: "sentence-mining", x: 2, y: 3375},
             %{height: 1471, project: "w2", x: 4, y: 2129},
             %{height: 1164, project: "w2", x: 5, y: 2436},
             %{height: 2529, project: "w2", x: 6, y: 1071},
             %{height: 2063, project: "w2", x: 7, y: 1537},
             %{height: 1281, project: "w2", x: 8, y: 2319},
             %{height: 597, project: "w2", x: 9, y: 3003},
             %{height: 3600, project: "w2", x: 10, y: 0},
             %{height: 3164, project: "w2", x: 11, y: 436},
             %{height: 310, project: "w2", x: 12, y: 3290},
             %{height: 2382, project: "w2", x: 25, y: 1218},
             %{height: 994, project: "ziglings", x: 35, y: 1683},
             %{height: 923, project: "learning", x: 35, y: 2677},
             %{height: 497, project: "ziglings", x: 36, y: 3103},
             %{height: 460, project: "ziglings", x: 38, y: 3140},
             %{height: 1183, project: "ziglings", x: 51, y: 2417},
             %{height: 1222, project: "ziglings", x: 52, y: 2378},
             %{height: 1512, project: "ziglings", x: 53, y: 2088},
             %{height: 2660, project: "ziglings", x: 54, y: 940},
             %{height: 0, project: "ziglings", x: 58, y: 3600},
             %{height: 557, project: "ziglings", x: 59, y: 3043},
             %{height: 2291, project: "ziglings", x: 60, y: 1309},
             %{height: 6, project: "texture", x: 63, y: 3594},
             %{height: 758, project: "ziglings", x: 78, y: 2842},
             %{height: 740, project: "ziglings", x: 79, y: 2261},
             %{height: 113, project: "pacman-rules", x: 79, y: 3001},
             %{height: 298, project: "lasagna", x: 79, y: 3114},
             %{height: 188, project: "hello-world", x: 79, y: 3412},
             %{height: 2004, project: "ziglings", x: 80, y: 1596},
             %{height: 1327, project: "ziglings", x: 81, y: 1070},
             %{height: 1203, project: "objdump2", x: 81, y: 2397},
             %{height: 1662, project: "ziglings", x: 82, y: 364},
             %{height: 1574, project: "ziglearn", x: 82, y: 2026},
             %{height: 453, project: "ziglearn", x: 83, y: 3147},
             %{height: 17, project: "n", x: 84, y: 3583},
             %{height: 1148, project: "n", x: 85, y: 2452},
             %{height: 0, project: "n", x: 86, y: 3600},
             %{height: 900, project: "ziglearn", x: 102, y: 2700},
             %{height: 2692, project: "ziglearn", x: 104, y: 908},
             %{height: 2277, project: "ziglearn", x: 105, y: 1323},
             %{height: 2873, project: "ziglearn", x: 106, y: 727},
             %{height: 1845, project: "ziglearn", x: 107, y: 1755},
             %{height: 1469, project: "w2", x: 108, y: 2131},
             %{height: 1950, project: "ziglearn", x: 109, y: 1650},
             %{height: 2421, project: "ziglearn", x: 124, y: 1179},
             %{height: 2058, project: "ziglearn", x: 125, y: 1542},
             %{height: 1627, project: "ziglearn", x: 126, y: 1973},
             %{height: 1356, project: "ziglearn", x: 127, y: 2214},
             %{height: 30, project: "table-helper", x: 127, y: 3570},
             %{height: 1533, project: "ziglearn", x: 128, y: 1507},
             %{height: 560, project: "learnXinY", x: 128, y: 3040},
             %{height: 2, project: "learnXinY", x: 129, y: 3598},
             %{height: 100, project: "learnXinY", x: 130, y: 1101},
             %{height: 2399, project: "double", x: 130, y: 1201},
             %{height: 2471, project: "double", x: 131, y: 1129},
             %{height: 2724, project: "double", x: 132, y: 876},
             %{height: 765, project: "w2", x: 133, y: 1295},
             %{height: 1540, project: "double", x: 133, y: 2060},
             %{height: 224, project: "w2", x: 134, y: 2915},
             %{height: 461, project: "double", x: 134, y: 3139},
             %{height: 336, project: "w2", x: 142, y: 1733},
             %{height: 1531, project: "double", x: 142, y: 2069},
             %{height: 59, project: "w2", x: 143, y: 866},
             %{height: 1697, project: "e", x: 143, y: 925},
             %{height: 978, project: "double", x: 143, y: 2622},
             %{height: 1021, project: "w2", x: 144, y: 2104},
             %{height: 475, project: "e", x: 144, y: 3125},
             %{height: 0, project: "double", x: 144, y: 3600},
             %{height: 1909, project: "w2", x: 145, y: 1407},
             %{height: 284, project: "durations", x: 145, y: 3316},
             %{height: 2922, project: "durations", x: 146, y: 678},
             %{height: 2270, project: "durations", x: 147, y: 1330},
             %{height: 751, project: "durations", x: 148, y: 2849},
             %{height: 232, project: "durations", x: 150, y: 3368},
             %{height: 522, project: "w2", x: 152, y: 3078},
             %{height: 414, project: "durations", x: 155, y: 3186},
             %{height: 3600, project: "durations", x: 156, y: 0},
             %{height: 3600, project: "durations", x: 157, y: 0},
             %{height: 2261, project: "durations", x: 158, y: 1339},
             %{height: 254, project: "mkjson", x: 166, y: 3346}
           ]
  end
end
